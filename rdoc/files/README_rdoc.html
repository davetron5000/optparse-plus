<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>README.rdoc</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            README.rdoc
        </h1>
        <ul class="files">
            <li>README.rdoc</li>
            <li>Last modified: 2022-07-16 12:39:52 -0400</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="label-optparse-plus+-+Wrapper+around+OptionParse+to+Make+CLIs+a+bit+Easier">optparse-plus - Wrapper around OptionParse to Make CLIs a bit Easier</h1>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Dave Copeland (<a href="mailto:davetron5000">davetron5000</a> at g mail dot com)</p>
</dd><dt>Copyright
<dd>
<p>Copyright © 2011 by Dave Copeland</p>
</dd><dt>License
<dd>
<p>Distributes under the Apache License, see LICENSE.txt in the source distro</p>
</dd></dl>

<p>A smattering of tools to make your command-line apps easily awesome; Ideally makes it almost as easy as bash to get a command line app up and running.</p>

<p>The goal of this project is to make it as easy as possible to write awesome and powerful command-line applications.</p>

<p>Toward that end, this gem provides:</p>
<ul><li>
<p>A command-line app to bootstrap a new command-line app.</p>
</li><li>
<p>A lightweight DSL to create your command-line interface, that loses none of <code>OptionParser</code>&#39;s power.</p>
</li><li>
<p>A simplified means of running external commands that has better error handling and diagnostics.</p>
</li><li>
<p>Simplified zero-config logging that is a better-than-<code>puts</code> <code>puts</code>.</p>
</li><li>
<p>Support for integration-testing your CLI using Test::Unit</p>
</li></ul>

<p><a href="https://github.com/davetron5000/optparse-plus/wiki/Name-Change">Read about the name change if you care</a></p>

<h2 id="label-Platforms">Platforms</h2>

<p>This library only supports the latest versions of Ruby. JRuby support has been too difficult to keep up with, though the library should work for JRuby.</p>

<h2 id="label-Bootstrapping+a+new+CLI+App">Bootstrapping a new CLI App</h2>

<p>The <code>optparse_plus</code> command-line app will bootstrap a new command-line app, setting up a proper gem structure, unit tests, and integration tests.</p>

<p>It assumes you are using a standard Ruby development environment, which includes:</p>
<ul><li>
<p>Some sort of Ruby version manager to allow you to manage Ruby as yourself and not as root/system</p>
</li><li>
<p>Bundler</p>
</li><li>
<p>Git</p>
</li></ul>

<p>_(Note that apps <strong>powered</strong> by this gem have no particular runtime dependencies as classes this gem provides depend only on the standard library)_</p>

<pre><code>$ optparse_plus --help
Usage: optparse_plus [options] app_name

Kick the bash habit by bootstrapping your Ruby command-line apps

v2.0.0

Options:
    -h, --help                       Show command line help
        --force                      Overwrite files if they exist
        --[no-]readme                [Do not ]produce a README file
        --rspec                      Generate RSpec unit tests instead of Test::Unit
    -l, --license LICENSE            Specify the license for your project
                                     (mit|apache|gplv2|gplv3|custom|NONE)
        --log-level LEVEL            Set the logging level
                                     (debug|info|warn|error|fatal)
                                     (Default: info)
        --version                    Show help/version info

Arguments:

    app_name
        Name of your app, which is used for the gem name and executable name

Usage: optparse_plus [options] app_name
        --force                      Overwrite files if they exist
$ optparse_plus myapp -l mit
$ cd myapp
$ bundle install
...
$ bundle exec rake
Started
.
Finished in 0.000499 seconds.
-----------------------------------------------------------------------------------------
1 tests, 1 assertions, 0 failures, 0 errors, 0 pendings, 0 omissions, 0 notifications
100% passed
-----------------------------------------------------------------------------------------
2004.01 tests/s, 2004.01 assertions/s
Started
.
Finished in 0.298281 seconds.
-----------------------------------------------------------------------------------------
1 tests, 8 assertions, 0 failures, 0 errors, 0 pendings, 0 omissions, 0 notifications
100% passed
-----------------------------------------------------------------------------------------
3.35 tests/s, 26.82 assertions/s

$ cat test/integration/test_cli.rb
require &quot;optparse_plus/test/base_integration_test&quot;

class TestSomething &lt; OptparsePlus::BaseIntegrationTest
  def test_truth
    stdout,stderr,results = run_app(&quot;myapp&quot;,&quot;--help&quot;)
    assert_banner(stdout, &quot;myapp&quot;, takes_options: true, takes_arguments: false)
    assert_option(stdout,&quot;-h&quot;, &quot;--help&quot;)
    assert_option(stdout,&quot;--version&quot;)
    assert_oneline_summary(stdout)
  end
end
</code></pre>

<p>Basically, this sets you up with all the boilerplate that you <strong>should</strong> be using to write a command-line app.  Specifically, you get:</p>
<ul><li>
<p>Gemified project (based on <code>bundle gem</code>)</p>
</li><li>
<p>An executable using <a href="../classes/OptparsePlus/Main.html"><code>OptparsePlus::Main</code></a> to outline your new app</p>
</li><li>
<p><code>Test::Unit</code> test task set up and an empty unit test.</p>
</li><li>
<p><code>Test::Unit</code> integration tests with some of optparse-plus&#39;s assertions to let you drive your CLI&#39;s development</p>
</li><li>
<p>The outline of a <a href="README_rdoc.html">README</a></p>
</li><li>
<p>An optional license included</p>
</li></ul>

<h2 id="label-DSL+for+your+bin+file">DSL for your <code>bin</code> file</h2>

<p>A canonical <code>OptionParser</code>-driven app has a few problems with it structurally that optparse-plus can solve:</p>
<ul><li>
<p>Backwards organization - main logic is at the bottom of the file, not the top</p>
</li><li>
<p>Verbose to use <code>opts.on</code> just to set a value in a <code>Hash</code></p>
</li><li>
<p>No exception handling - you have to explicitly call <code>exit</code> and/or let exceptions&#39; stack traces leak through.</p>
</li></ul>

<p>optparse-plus provides <a href="../classes/OptparsePlus/Main.html"><code>OptparsePlus::Main</code></a> to help make a clean and easy-to-maintain <code>bin</code> file.  See the  <a href="http://davetron5000.github.com/optparse-plus/rdoc/classes/OptparsePlus/Main.html">rdoc</a> for an example, and see <a href="http://www.naildrivin5.com/blog/2011/12/19/methadone-the-awesome-cli-library.html">my blog</a> on the derivation of this module.</p>

<h2 id="label-Wrapper+for+running+external+commands+with+good+logging">Wrapper for running external commands with good logging</h2>

<p>While backtick and <code>%x[]</code> are nice for compact, bash-like scripting, they have some failings:</p>
<ul><li>
<p>You have to check the return value via <code>$?</code></p>
</li><li>
<p>You have no access to the standard error</p>
</li><li>
<p>You really want to log: the command, the output, and the error so that for cron-like tasks, you can sort out what happened</p>
</li></ul>

<p>Enter <a href="../classes/OptparsePlus/SH.html"><code>OptparsePlus::SH</code></a> </p>

<pre><code>sh &quot;cp foo.txt /tmp&quot;
# =&gt; logs command at DEBUG level
#    if the command exited zero:
#        logs the standard output at DEBUG
#        logs the standard error at WARN
#    if the command exited nonzero:
#        logs the standard output at INFO
#        logs the standard error at WARN
#        returns the exit code for your examination
#
#        there&#39;s a LOT MORE
</code></pre>

<p>See the <a href="http://davetron5000.github.com/optparse-plus/rdoc/classes/OptparsePlus/SH.html">rdoc</a> for more detailed examples and usage.</p>

<p>This isn&#39;t a replacement for Open3 or ChildProcess, but a way to easily “do the right thing” for most cases.</p>

<h2 id="label-Zero-Config+Logging">Zero-Config Logging</h2>

<p>Chances are, your code is littered with <code>STDERR.puts</code> on a good day, and nothing on a bad day.  You probably also have a bunch of debug <code>puts</code> calls that you have commented out.  Logging is extremely helpful in understanding how your app is behaving (or how it behaved in the past).  Logging can be a pain to set up, and can also make it hard to give the user at the command-prompt a good experience.</p>

<p><a href="../classes/OptparsePlus/CLILogger.html"><code>OptparsePlus::CLILogger</code></a> is designed to handle this.  It&#39;s a proper subclass of Ruby&#39;s built-in <code>Logger</code> with a few enhancements:</p>
<ul><li>
<p>Messages don&#39;t get formatting if they are destined for a TTY (e.g. the user sitting at her terminal)</p>
</li><li>
<p>Errors and warnings go to the standard error.</p>
</li><li>
<p>Debug and info messages go to the standard output.</p>
</li><li>
<p>When these are redirected to a file, the log messages are properly date/time stamped as you&#39;d expect</p>
</li><li>
<p>You can mix-in <a href="../classes/OptparsePlus/CLILogging.html"><code>OptparsePlus::CLILogging</code></a> to get access to a global logger instances without resorting to an explicit global variable</p>
</li></ul>

<p>See <a href="http://davetron5000.github.com/optparse-plus/rdoc/classes/OptparsePlus/CLILogger.html">CLILogger’s rdoc</a> and then <a href="http://davetron5000.github.com/optparse-plus/rdoc/classes/OptparsePlus/CLILogging.html">CLILogging’s</a> for more.</p>

<p>Currently, there are classes that assist in directing output logger-style to the right place; basically ensuring that errors go to <code>STDERR</code> and everything else goes to <code>STDOUT</code>.  All of this is, of course, configurable</p>

<h2 id="label-Integration+Tests">Integration Tests</h2>

<p>optparse-plus provides some basic features for executing your CLI and asserting things about it.  OptparsePlus::Test::IntegrationTestAssertions documents these.</p>

<h2 id="label-Contributing">Contributing</h2>
<ul><li>
<p>Feel free to file an issue, even if you don&#39;t have time to submit a patch</p>
</li><li>
<p>Please try to include a test for any patch you submit.  If you don&#39;t include a test, I&#39;ll have to write one, and it&#39;ll take longer to get your code in.</p>
</li><li>
<p>This is not intended to support “command-suite” style CLIs.  See <a href="http://naildrivin5.com/gli">GLI</a> if that&#39;s what you want.</p>
</li></ul>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </div>
  </body>
</html>
